<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hunde verwalten - Gassigeher Admin</title>
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="/" class="logo">üêï Gassigeher Admin</a>
            <nav>
                <ul>
                    <li><a href="/admin-dashboard.html" data-i18n="admin_dashboard.title">Dashboard</a></li>
                    <li><a href="/admin-dogs.html" data-i18n="dogs.manage_dogs">Hunde</a></li>
                    <li><a href="/admin-bookings.html" data-i18n="admin.manage_bookings">Buchungen</a></li>
                    <li><a href="/admin-blocked-dates.html" data-i18n="admin.manage_blocked_dates">Gesperrte Tage</a></li>
                    <li><a href="/admin-experience-requests.html" data-i18n="admin.manage_experience_requests">Level-Anfragen</a></li>
                    <li><a href="/admin-users.html" data-i18n="users.title">Benutzer</a></li>
                    <li><a href="/admin-reactivation-requests.html" data-i18n="reactivation.manage_requests">Reaktivierungen</a></li>
                    <li><a href="/admin-settings.html" data-i18n="admin_dashboard.system_settings">Einstellungen</a></li>
                    <li><a href="#" onclick="api.logout()" data-i18n="nav.logout">Abmelden</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main style="padding: 40px 0;">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1 data-i18n="dogs.manage_dogs">Hunde verwalten</h1>
                <button class="btn" onclick="showAddDogForm()" data-i18n="dogs.add_dog">Hund hinzuf√ºgen</button>
            </div>

            <div id="alert-container"></div>

            <!-- Add/Edit Dog Form (hidden by default) -->
            <div id="dog-form-container" class="card hidden" style="margin-bottom: 30px;">
                <h3 id="form-title" data-i18n="dogs.add_dog">Hund hinzuf√ºgen</h3>
                <form id="dog-form">
                    <input type="hidden" id="dog-id">
                    <div class="form-group">
                        <label data-i18n="dogs.name">Name</label>
                        <input type="text" id="dog-name" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="dogs.breed">Rasse</label>
                        <input type="text" id="dog-breed" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="dogs.size">Gr√∂√üe</label>
                        <select id="dog-size" required>
                            <option value="small" data-i18n="dogs.size_small">Klein</option>
                            <option value="medium" data-i18n="dogs.size_medium">Mittel</option>
                            <option value="large" data-i18n="dogs.size_large">Gro√ü</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="dogs.age">Alter</label>
                        <input type="number" id="dog-age" min="0" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="dogs.category">Kategorie</label>
                        <select id="dog-category" required>
                            <option value="green" data-i18n="dogs.category_green">Gr√ºn</option>
                            <option value="blue" data-i18n="dogs.category_blue">Blau</option>
                            <option value="orange" data-i18n="dogs.category_orange">Orange</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn" data-i18n="common.save">Speichern</button>
                        <button type="button" class="btn btn-secondary" onclick="hideForm()" data-i18n="common.cancel">Abbrechen</button>
                    </div>
                </form>
            </div>

            <!-- Dogs List -->
            <div id="dogs-list" class="dog-grid"></div>
        </div>
    </main>

    <script src="/js/i18n.js"></script>
    <script src="/js/api.js"></script>
    <script>
        let currentDogs = [];

        document.addEventListener('DOMContentLoaded', async () => {
            if (!api.isAuthenticated()) {
                window.location.href = '/login.html';
                return;
            }

            await window.i18n.load();
            loadDogs();

            document.getElementById('dog-form').addEventListener('submit', handleFormSubmit);
        });

        async function loadDogs() {
            try {
                currentDogs = await api.getDogs();
                renderDogs();
            } catch (error) {
                showAlert('error', error.message || 'Fehler beim Laden der Hunde');
            }
        }

        function renderDogs() {
            const container = document.getElementById('dogs-list');
            if (currentDogs.length === 0) {
                container.innerHTML = '<p data-i18n="dogs.no_dogs">Keine Hunde gefunden</p>';
                return;
            }

            container.innerHTML = currentDogs.map(dog => `
                <div class="dog-card ${!dog.is_available ? 'unavailable' : ''}">
                    ${!dog.is_available ? `<div class="dog-unavailable-banner">${dog.unavailable_reason || 'Nicht verf√ºgbar'}</div>` : ''}
                    ${dog.photo ? `<img src="/uploads/${dog.photo}" class="dog-card-image" alt="${dog.name}">` : '<div class="dog-card-image" style="background: #ddd; display: flex; align-items: center; justify-content: center;">üêï</div>'}
                    <div class="dog-card-body">
                        <div class="dog-category-badge ${dog.category}">${getCategoryLabel(dog.category)}</div>
                        <h3 class="dog-card-title">${dog.name}</h3>
                        <p class="dog-card-info">${dog.breed} ‚Ä¢ ${getSizeLabel(dog.size)} ‚Ä¢ ${dog.age} Jahre</p>
                        <div style="display: flex; gap: 5px; margin-top: 10px;">
                            <button class="btn" style="flex: 1; padding: 8px;" onclick="editDog(${dog.id})">‚úèÔ∏è</button>
                            <button class="btn btn-secondary" style="flex: 1; padding: 8px;" onclick="toggleAvailability(${dog.id}, ${!dog.is_available})">
                                ${dog.is_available ? 'üö´' : '‚úÖ'}
                            </button>
                            <button class="btn btn-danger" style="flex: 1; padding: 8px;" onclick="deleteDog(${dog.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryLabel(category) {
            const labels = { green: 'Gr√ºn', blue: 'Blau', orange: 'Orange' };
            return labels[category] || category;
        }

        function getSizeLabel(size) {
            const labels = { small: 'Klein', medium: 'Mittel', large: 'Gro√ü' };
            return labels[size] || size;
        }

        function showAddDogForm() {
            document.getElementById('form-title').textContent = 'Hund hinzuf√ºgen';
            document.getElementById('dog-form').reset();
            document.getElementById('dog-id').value = '';
            document.getElementById('dog-form-container').classList.remove('hidden');
        }

        function editDog(id) {
            const dog = currentDogs.find(d => d.id === id);
            if (!dog) return;

            document.getElementById('form-title').textContent = 'Hund bearbeiten';
            document.getElementById('dog-id').value = dog.id;
            document.getElementById('dog-name').value = dog.name;
            document.getElementById('dog-breed').value = dog.breed;
            document.getElementById('dog-size').value = dog.size;
            document.getElementById('dog-age').value = dog.age;
            document.getElementById('dog-category').value = dog.category;
            document.getElementById('dog-form-container').classList.remove('hidden');
        }

        function hideForm() {
            document.getElementById('dog-form-container').classList.add('hidden');
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            const id = document.getElementById('dog-id').value;
            const data = {
                name: document.getElementById('dog-name').value,
                breed: document.getElementById('dog-breed').value,
                size: document.getElementById('dog-size').value,
                age: parseInt(document.getElementById('dog-age').value),
                category: document.getElementById('dog-category').value,
            };

            try {
                if (id) {
                    await api.updateDog(id, data);
                    showAlert('success', 'Hund erfolgreich aktualisiert');
                } else {
                    await api.createDog(data);
                    showAlert('success', 'Hund erfolgreich hinzugef√ºgt');
                }
                hideForm();
                loadDogs();
            } catch (error) {
                showAlert('error', error.message || 'Fehler beim Speichern');
            }
        }

        async function toggleAvailability(id, isAvailable) {
            const reason = isAvailable ? null : prompt('Grund f√ºr Nichtverf√ºgbarkeit:');
            if (!isAvailable && !reason) return;

            try {
                await api.toggleDogAvailability(id, isAvailable, reason);
                showAlert('success', 'Status aktualisiert');
                loadDogs();
            } catch (error) {
                showAlert('error', error.message || 'Fehler beim Aktualisieren');
            }
        }

        async function deleteDog(id) {
            if (!confirm('Sind Sie sicher, dass Sie diesen Hund l√∂schen m√∂chten?')) return;

            try {
                await api.deleteDog(id);
                showAlert('success', 'Hund erfolgreich gel√∂scht');
                loadDogs();
            } catch (error) {
                showAlert('error', error.message || 'Fehler beim L√∂schen');
            }
        }

        function showAlert(type, message) {
            const container = document.getElementById('alert-container');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }
    </script>
</body>
</html>
